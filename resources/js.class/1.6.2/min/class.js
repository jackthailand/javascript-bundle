JS={extend:function(a,b){for(var c in b)a[c]=b[c]},method:function(a){var b=this,c=b._methods=b._methods||{};if((c[a]||{}).fn==b[a])return c[a].bd;return(c[a]={fn:b[a],bd:b[a].bind(b)}).bd},util:{}};Array.from=function(a){if(!a)return[];if(a.toArray)return a.toArray();var b=a.length,c=[];while(b--)c[b]=a[b];return c};JS.extend(Function.prototype,{bind:function(){var a=this,b=Array.from(arguments),c=b.shift()||null;return function(){return a.apply(c,b.concat(Array.from(arguments)))}},callsSuper:function(){return/\bcallSuper\b/.test(this.toString())},is:function(a){return typeof a=='function'}});JS.Class=function(){var a=Array.from(arguments),b,c=Function.is(a[0])?a.shift():null,d=JS.Class.create(c);while(b=a.shift())d.include(b);c&&Function.is(c.inherited)&&c.inherited(d);return d};JS.extend(JS.Class,{create:function(a){var b=function(){this.initialize.apply(this,arguments)};this.ify(b);a&&this.subclass(a,b);var c=b.prototype;c.klass=c.constructor=b;b.include(this.INSTANCE_METHODS,false);b.instanceMethod('extend',this.INSTANCE_METHODS.extend,false);return b},ify:function(a,b){a.superclass=a.superclass||Object;a.subclasses=a.subclasses||[];if(b===false)return a;for(var c in this.CLASS_METHODS)this.CLASS_METHODS.hasOwnProperty(c)&&(a[c]=this.CLASS_METHODS[c]);return a},subclass:function(a,b){this.ify(a,false);b.superclass=a;a.subclasses.push(b);var c=function(){};c.prototype=a.prototype;b.prototype=new c();b.extend(a);return b},properties:function(a){var b={},c,d=this.ify(function(){});loop:for(var e in a){for(c in d){if(e==c)continue loop}b[e]=a[e]}return b},addMethod:function(h,i,f,g){if(!Function.is(g))return(h[f]=g);if(!g.callsSuper())return(h[f]=g);var j=function(){var b=i[f],c=Array.from(arguments),d=this.callSuper,e;Function.is(b)&&(this.callSuper=function(){var a=arguments.length;while(a--)c[a]=arguments[a];return b.apply(this,c)});e=g.apply(this,arguments);d?this.callSuper=d:delete this.callSuper;return e};j.valueOf=function(){return g};j.toString=function(){return g.toString()};h[f]=j},INSTANCE_METHODS:{initialize:function(){},method:JS.method,extend:function(a){for(var b in a)a.hasOwnProperty(b)&&JS.Class.addMethod(this,this.klass.prototype,b,a[b]);return this},isA:function(a){var b=this.klass;while(b){if(b===a)return true;b=b.superclass}return false}},CLASS_METHODS:{include:function(a,b){var c,d,e,h=a.include,i=a.extend;if(h){c=[].concat(h);for(d=0,e=c.length;d<e;d++)this.include(c[d],b)}if(i){c=[].concat(i);for(d=0,e=c.length;d<e;d++)this.extend(c[d],b)}for(var f in a){!/^(included?|extend(ed)?)$/.test(f)&&this.instanceMethod(f,a[f],b)}Function.is(a.included)&&a.included(this);return this},instanceMethod:function(a,b,c){if(!this.prototype[a]||c!==false)JS.Class.addMethod(this.prototype,this.superclass.prototype,a,b);return this},extend:function(a,b){Function.is(a)&&(a=JS.Class.properties(a));for(var c in a){a.hasOwnProperty(c)&&!/^(included?|extend(ed)?)$/.test(c)&&this.classMethod(c,a[c],b)}Function.is(a.extended)&&a.extended(this);return this},classMethod:function(a,b,c){for(var d=0,e=this.subclasses.length;d<e;d++)this.subclasses[d].classMethod(a,b,false);(!this[a]||c!==false)&&JS.Class.addMethod(this,this.superclass,a,b);return this},method:JS.method}});JS.extend(JS,{Interface:JS.Class({initialize:function(d){this.test=function(a,b){var c=d.length;while(c--){if(!Function.is(a[d[c]]))return b?d[c]:false}return true}},extend:{ensure:function(){var a=Array.from(arguments),b=a.shift(),c,d;while(c=a.shift()){d=c.test(b,true);if(d!==true)throw new Error('object does not implement '+d+'()');}}}}),Singleton:function(){return new(JS.Class.apply(JS,arguments))},Module:function(b){return{included:function(a){a.include(b)},extended:function(a){a.extend(b)}}}});